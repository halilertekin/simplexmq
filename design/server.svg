<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1140" height="677pt" viewBox="0 0 855 677.4"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 673.3999)"><title>SMPServer</title><polygon fill="#fff" stroke="transparent" points="-4 4 -4 -673.4 851 -673.4 851 4 -4 4"/><g id="clust1" class="cluster"><title>clusterPersistence</title><polygon fill="none" stroke="#000" points="671 -112.175 671 -200.275 839 -200.275 839 -112.175 671 -112.175"/><text x="755" y="-183.675" fill="#000" font-family="arial" font-size="14" text-anchor="middle">persistence (STM)</text></g><g id="clust2" class="cluster"><title>clusterServer</title><polygon fill="none" stroke="#000" points="8 -356.45 8 -661.4 314 -661.4 314 -356.45 8 -356.45"/><text x="161" y="-644.8" fill="#000" font-family="arial" font-size="14" text-anchor="middle">server threads</text></g><g id="clust3" class="cluster"><title>clusterThreads</title><polygon fill="none" stroke="#000" points="96 -364.45 96 -436.625 306 -436.625 306 -364.45 96 -364.45"/></g><g id="clust5" class="cluster"><title>clusterConnection</title><polygon fill="none" stroke="#000" points="322 -8 322 -545.425 663 -545.425 663 -8 322 -8"/><text x="492.5" y="-528.825" fill="#000" font-family="arial" font-size="14" text-anchor="middle">1 group per client connection</text></g><g id="clust6" class="cluster"><title>clusterThreads</title><polygon fill="none" stroke="#000" points="330 -254.275 330 -326.45 621 -326.45 621 -254.275 330 -254.275"/></g><g id="node1" class="node"><title>msgQueues</title><path fill="none" stroke="#000" d="M831.1227,-163.2985C831.1227,-165.6863 817.6212,-167.6259 801,-167.6259 784.3788,-167.6259 770.8773,-165.6863 770.8773,-163.2985 770.8773,-163.2985 770.8773,-124.3515 770.8773,-124.3515 770.8773,-121.9636 784.3788,-120.024 801,-120.024 817.6212,-120.024 831.1227,-121.9636 831.1227,-124.3515 831.1227,-124.3515 831.1227,-163.2985 831.1227,-163.2985"/><path fill="none" stroke="#000" d="M831.1227,-163.2985C831.1227,-160.9107 817.6212,-158.971 801,-158.971 784.3788,-158.971 770.8773,-160.9107 770.8773,-163.2985"/><text x="801" y="-147.125" fill="#000" font-family="arial" font-size="11" text-anchor="middle">Message</text><text x="801" y="-133.925" fill="#000" font-family="arial" font-size="11" text-anchor="middle">queues</text></g><g id="node13" class="node"><title>subscriber</title><polygon fill="none" stroke="orange" points="655.46 -44.087 628.23 -72.263 573.77 -72.263 546.54 -44.087 573.77 -15.912 628.23 -15.912 655.46 -44.087"/><text x="601" y="-47.388" fill="#000" font-family="arial" font-size="11" text-anchor="middle">subscriber</text><text x="601" y="-34.188" fill="#000" font-family="arial" font-size="11" text-anchor="middle">thread</text></g><g id="edge13" class="edge"><title>msgQueues-&gt;subscriber</title><path fill="none" stroke="#0f0" d="M775.3099,-121.3134C771.01,-118.0388 766.485,-114.869 762,-112.175 727.1066,-91.2154 684.5821,-73.5284 652.0009,-61.4383"/><polygon fill="#0f0" stroke="#0f0" points="642.228 -57.868 653.165 -57.073 646.925 -59.584 651.621 -61.3 651.621 -61.3 651.621 -61.3 646.925 -59.584 650.077 -65.526 642.228 -57.868 642.228 -57.868"/><text x="761.283" y="-93.175" fill="#0f0" font-family="arial" font-size="10" text-anchor="middle">Message</text></g><g id="node2" class="node"><title>queueStore</title><path fill="none" stroke="#000" d="M752.9666,-163.2985C752.9666,-165.6863 736.3976,-167.6259 716,-167.6259 695.6024,-167.6259 679.0334,-165.6863 679.0334,-163.2985 679.0334,-163.2985 679.0334,-124.3515 679.0334,-124.3515 679.0334,-121.9636 695.6024,-120.024 716,-120.024 736.3976,-120.024 752.9666,-121.9636 752.9666,-124.3515 752.9666,-124.3515 752.9666,-163.2985 752.9666,-163.2985"/><path fill="none" stroke="#000" d="M752.9666,-163.2985C752.9666,-160.9107 736.3976,-158.971 716,-158.971 695.6024,-158.971 679.0334,-160.9107 679.0334,-163.2985"/><text x="716" y="-147.125" fill="#000" font-family="arial" font-size="11" text-anchor="middle">SMP queue</text><text x="716" y="-133.925" fill="#000" font-family="arial" font-size="11" text-anchor="middle">records</text></g><g id="node3" class="node"><title>main</title><polygon fill="none" stroke="orange" points="93.542 -600.512 74.271 -628.688 35.729 -628.688 16.458 -600.512 35.729 -572.337 74.271 -572.337 93.542 -600.512"/><text x="55" y="-603.812" fill="#000" font-family="arial" font-size="11" text-anchor="middle">main</text><text x="55" y="-590.612" fill="#000" font-family="arial" font-size="11" text-anchor="middle">thread</text></g><g id="node5" class="node"><title>runClient</title><polygon fill="none" stroke="orange" points="297.981 -400.537 273.491 -428.713 224.509 -428.713 200.019 -400.537 224.509 -372.362 273.491 -372.362 297.981 -400.537"/><text x="249" y="-403.837" fill="#000" font-family="arial" font-size="11" text-anchor="middle">runClient</text><text x="249" y="-390.637" fill="#000" font-family="arial" font-size="11" text-anchor="middle">thread</text></g><g id="edge1" class="edge"><title>main-&gt;runClient</title><path fill="none" stroke="orange" stroke-dasharray="5 2" d="M82.4126,-583.8786C98.0501,-573.7433 117.5501,-559.9715 133,-545.4249 168.3831,-512.1106 202.3371,-467.7613 224.2648,-436.9423"/><polygon fill="orange" stroke="orange" points="230.122 -428.629 228.041 -439.396 227.242 -432.716 224.362 -436.804 224.362 -436.804 224.362 -436.804 227.242 -432.716 220.684 -434.212 230.122 -428.629 230.122 -428.629"/><text x="203.724" y="-491.625" fill="orange" font-family="arial" font-size="10" text-anchor="middle">race</text></g><g id="node6" class="node"><title>server</title><polygon fill="none" stroke="orange" points="181.542 -400.537 162.271 -428.713 123.729 -428.713 104.458 -400.537 123.729 -372.362 162.271 -372.362 181.542 -400.537"/><text x="143" y="-403.837" fill="#000" font-family="arial" font-size="11" text-anchor="middle">server</text><text x="143" y="-390.637" fill="#000" font-family="arial" font-size="11" text-anchor="middle">thread</text></g><g id="edge2" class="edge"><title>main-&gt;server</title><path fill="none" stroke="orange" stroke-dasharray="5 2" d="M67.4216,-572.285C82.8393,-537.2492 109.19,-477.3686 126.3476,-438.379"/><polygon fill="orange" stroke="orange" points="130.499 -428.944 130.59 -439.91 128.486 -433.521 126.472 -438.097 126.472 -438.097 126.472 -438.097 128.486 -433.521 122.353 -436.285 130.499 -428.944 130.499 -428.944"/><text x="119.724" y="-491.625" fill="orange" font-family="arial" font-size="10" text-anchor="middle">race</text></g><g id="node4" class="node"><title>ss</title><polygon fill="none" stroke="#00f" points="218.452 -618.512 111.548 -618.512 111.548 -582.512 218.452 -582.512 218.452 -618.512"/><text x="165" y="-597.212" fill="#000" font-family="arial" font-size="11" text-anchor="middle">server TCP socket</text></g><g id="edge3" class="edge"><title>ss-&gt;runClient</title><path fill="none" stroke="#00f" d="M190.6135,-582.3228C202.2946,-572.6811 215.2249,-559.8501 223,-545.4249 240.8424,-512.3216 246.7634,-469.4031 248.5729,-438.8905"/><polygon fill="#00f" stroke="#00f" points="249.054 -428.652 253.08 -438.852 248.819 -433.646 248.584 -438.641 248.584 -438.641 248.584 -438.641 248.819 -433.646 244.089 -438.429 249.054 -428.652 249.054 -428.652"/></g><g id="node8" class="node"><title>cs</title><polygon fill="none" stroke="#00f" points="552.81 -512.625 395.19 -512.625 395.19 -476.625 552.81 -476.625 552.81 -512.625"/><text x="474" y="-491.325" fill="#000" font-family="arial" font-size="11" text-anchor="middle">client connection TCP socket</text></g><g id="edge5" class="edge"><title>runClient-&gt;cs</title><path fill="none" stroke="#00f" stroke-dasharray="5 2" d="M272.5995,-428.901C283.0081,-439.7165 296.0409,-451.2129 309.985,-458.6249 332.9376,-470.8253 359.7984,-478.8942 385.0605,-484.2295"/><polygon fill="#00f" stroke="#00f" points="395.023 -486.213 384.337 -488.674 390.12 -485.237 385.216 -484.26 385.216 -484.26 385.216 -484.26 390.12 -485.237 386.094 -479.847 395.023 -486.213 395.023 -486.213"/><text x="326.507" y="-449.625" fill="#00f" font-family="arial" font-size="10" text-anchor="middle">connect</text></g><g id="node9" class="node"><title>receive</title><polygon fill="none" stroke="orange" points="422.013 -290.362 401.007 -318.538 358.993 -318.538 337.987 -290.362 358.993 -262.187 401.007 -262.187 422.013 -290.362"/><text x="380" y="-293.662" fill="#000" font-family="arial" font-size="11" text-anchor="middle">receive</text><text x="380" y="-280.462" fill="#000" font-family="arial" font-size="11" text-anchor="middle">thread</text></g><g id="edge6" class="edge"><title>runClient-&gt;receive</title><path fill="none" stroke="orange" stroke-dasharray="5 2" d="M242.4559,-372.1449C241.3023,-360.1277 242.3132,-346.5931 249.553,-336.4499 259.7013,-322.232 300.429,-309.2925 333.711,-300.7686"/><polygon fill="orange" stroke="orange" points="343.759 -298.268 335.141 -305.05 338.907 -299.476 334.055 -300.683 334.055 -300.683 334.055 -300.683 338.907 -299.476 332.968 -296.316 343.759 -298.268 343.759 -298.268"/><text x="258.724" y="-339.45" fill="orange" font-family="arial" font-size="10" text-anchor="middle">race</text></g><g id="node10" class="node"><title>client</title><polygon fill="none" stroke="orange" points="612.542 -290.362 593.271 -318.538 554.729 -318.538 535.458 -290.362 554.729 -262.187 593.271 -262.187 612.542 -290.362"/><text x="574" y="-293.662" fill="#000" font-family="arial" font-size="11" text-anchor="middle">client</text><text x="574" y="-280.462" fill="#000" font-family="arial" font-size="11" text-anchor="middle">thread</text></g><g id="edge7" class="edge"><title>runClient-&gt;client</title><path fill="none" stroke="orange" stroke-dasharray="5 2" d="M277.06,-376.3985C296.597,-360.1633 321.2685,-340.9357 333.553,-336.4499 414.4215,-306.9205 446.2239,-356.2313 527,-326.4499 532.1882,-324.5371 537.2696,-321.8366 542.0605,-318.7636"/><polygon fill="orange" stroke="orange" points="550.331 -312.92 544.761 -322.366 546.247 -315.805 542.164 -318.691 542.164 -318.691 542.164 -318.691 546.247 -315.805 539.567 -315.016 550.331 -312.92 550.331 -312.92"/><text x="342.724" y="-339.45" fill="orange" font-family="arial" font-size="10" text-anchor="middle">race</text></g><g id="node11" class="node"><title>send</title><polygon fill="none" stroke="orange" points="517.542 -290.362 498.271 -318.538 459.729 -318.538 440.458 -290.362 459.729 -262.187 498.271 -262.187 517.542 -290.362"/><text x="479" y="-293.662" fill="#000" font-family="arial" font-size="11" text-anchor="middle">send</text><text x="479" y="-280.462" fill="#000" font-family="arial" font-size="11" text-anchor="middle">thread</text></g><g id="edge8" class="edge"><title>runClient-&gt;send</title><path fill="none" stroke="orange" stroke-dasharray="5 2" d="M260.5478,-372.3313C267.4946,-359.1125 277.7098,-344.526 291.553,-336.4499 318.388,-320.7945 401.9033,-337.3399 431,-326.4499 436.5046,-324.3897 441.9126,-321.4869 446.9995,-318.2123"/><polygon fill="orange" stroke="orange" points="455.218 -312.434 449.626 -321.867 451.128 -315.31 447.038 -318.186 447.038 -318.186 447.038 -318.186 451.128 -315.31 444.449 -314.505 455.218 -312.434 455.218 -312.434"/><text x="300.724" y="-339.45" fill="orange" font-family="arial" font-size="10" text-anchor="middle">race</text></g><g id="node12" class="node"><title>inq</title><polygon fill="none" stroke="#000" points="375.572 -56.087 330.428 -56.087 330.428 -32.087 375.572 -32.087 375.572 -26.087 393.572 -44.087 375.572 -62.087 375.572 -56.087"/><text x="362" y="-47.388" fill="#000" font-family="arial" font-size="11" text-anchor="middle">receive</text><text x="362" y="-34.188" fill="#000" font-family="arial" font-size="11" text-anchor="middle">TBQueue</text></g><g id="edge9" class="edge"><title>server-&gt;inq</title><path fill="none" stroke="#000" d="M160.3676,-372.2694C201.6259,-305.1164 305.0826,-136.7276 345.4771,-70.9806"/><polygon fill="#000" stroke="#000" points="350.745 -62.406 349.345 -73.282 348.128 -66.666 345.51 -70.926 345.51 -70.926 345.51 -70.926 348.128 -66.666 341.676 -68.57 350.745 -62.406 350.745 -62.406"/><text x="270.553" y="-223.275" fill="#000" font-family="arial" font-size="10" text-anchor="middle">END</text></g><g id="node7" class="node"><title>subscribedQ</title><polygon fill="none" stroke="#000" points="305.678 -612.512 254.322 -612.512 254.322 -618.512 236.322 -600.512 254.322 -582.512 254.322 -588.512 305.678 -588.512 305.678 -612.512"/><text x="271" y="-603.812" fill="#000" font-family="arial" font-size="11" text-anchor="middle">subscribed</text><text x="271" y="-590.612" fill="#000" font-family="arial" font-size="11" text-anchor="middle">TBQueue</text></g><g id="edge4" class="edge"><title>subscribedQ-&gt;server</title><path fill="none" stroke="#000" d="M266.5979,-582.0921C259.9663,-556.7857 245.7163,-510.5487 223,-476.6249 210.3763,-457.773 192.3233,-440.0878 176.5604,-426.5205"/><polygon fill="#000" stroke="#000" points="168.567 -419.817 179.121 -422.795 172.398 -423.03 176.229 -426.243 176.229 -426.243 176.229 -426.243 172.398 -423.03 173.338 -429.691 168.567 -419.817 168.567 -419.817"/></g><g id="edge10" class="edge"><title>cs-&gt;receive</title><path fill="none" stroke="#00f" d="M465.6581,-476.498C450.379,-443.2963 417.6111,-372.0915 397.3247,-328.0092"/><polygon fill="#00f" stroke="#00f" points="393.073 -318.769 401.341 -325.972 395.163 -323.311 397.253 -327.853 397.253 -327.853 397.253 -327.853 395.163 -323.311 393.165 -329.735 393.073 -318.769 393.073 -318.769"/></g><g id="edge11" class="edge"><title>receive-&gt;inq</title><path fill="none" stroke="#00f" d="M377.9352,-262.1116C374.4741,-214.757 367.5409,-119.8979 364.0738,-72.4613"/><polygon fill="#00f" stroke="#00f" points="363.33 -62.284 368.547 -71.93 363.695 -67.271 364.059 -72.258 364.059 -72.258 364.059 -72.258 363.695 -67.271 359.571 -72.586 363.33 -62.284 363.33 -62.284"/></g><g id="edge17" class="edge"><title>client-&gt;msgQueues</title><path fill="none" stroke="#0f0" d="M615.7447,-277.4263C656.3868,-263.3055 718.2574,-237.6106 762,-200.275 769.9504,-193.4891 777.0327,-184.7227 782.9078,-176.1309"/><polygon fill="#0f0" stroke="#0f0" points="606.147 -280.683 614.17 -273.209 610.881 -279.077 615.616 -277.47 615.616 -277.47 615.616 -277.47 610.881 -279.077 617.062 -281.731 606.147 -280.683 606.147 -280.683"/><polygon fill="#0f0" stroke="#0f0" points="788.368 -167.677 786.722 -178.519 785.655 -171.877 782.942 -176.077 782.942 -176.077 782.942 -176.077 785.655 -171.877 779.162 -173.636 788.368 -167.677 788.368 -167.677"/><text x="763.278" y="-235.275" fill="#000" font-family="arial" font-size="10" text-anchor="middle">SEND,</text><text x="763.278" y="-223.275" fill="#000" font-family="arial" font-size="10" text-anchor="middle">SUB,</text><text x="763.278" y="-211.275" fill="#000" font-family="arial" font-size="10" text-anchor="middle">ACK</text></g><g id="edge15" class="edge"><title>client-&gt;queueStore</title><path fill="none" stroke="#000" d="M609.8863,-268.3247C620.1282,-261.2548 630.9539,-252.9826 640,-244.275 661.2301,-223.8393 681.1673,-197.0861 695.2906,-176.3279"/><polygon fill="#000" stroke="#000" points="601.472 -273.964 607.274 -264.658 605.626 -271.18 609.779 -268.396 609.779 -268.396 609.779 -268.396 605.626 -271.18 612.284 -272.135 601.472 -273.964 601.472 -273.964"/><polygon fill="#000" stroke="#000" points="700.974 -167.834 699.153 -178.648 698.193 -171.99 695.413 -176.145 695.413 -176.145 695.413 -176.145 698.193 -171.99 691.673 -173.643 700.974 -167.834 700.974 -167.834"/></g><g id="edge21" class="edge"><title>client-&gt;subscribedQ</title><path fill="none" stroke="#000" d="M548.6699,-309.8896C541.6619,-315.2708 534.0458,-321.0992 527,-326.4499 456.1732,-380.2374 427.111,-381.0795 367,-446.6249 330.9316,-485.954 300.5471,-540.6501 284.1272,-573.1325"/><polygon fill="#000" stroke="#000" points="279.489 -582.458 279.913 -571.501 281.716 -577.982 283.942 -573.505 283.942 -573.505 283.942 -573.505 281.716 -577.982 287.971 -575.509 279.489 -582.458 279.489 -582.458"/><text x="391.719" y="-449.625" fill="#000" font-family="arial" font-size="10" text-anchor="middle">(rId, Client)</text></g><g id="edge16" class="edge"><title>client-&gt;subscriber</title><path fill="none" stroke="orange" stroke-dasharray="5 2" d="M577.0972,-262.1116C581.9467,-217.8786 591.3402,-132.1977 596.796,-82.4333"/><polygon fill="orange" stroke="orange" points="597.897 -72.387 601.281 -82.818 597.352 -77.357 596.808 -82.328 596.808 -82.328 596.808 -82.328 597.352 -77.357 592.334 -81.837 597.897 -72.387 597.897 -72.387"/><text x="619.12" y="-146.825" fill="#000" font-family="arial" font-size="10" text-anchor="middle">1 fork per</text><text x="619.12" y="-134.825" fill="#000" font-family="arial" font-size="10" text-anchor="middle">SMP queue</text></g><g id="node14" class="node"><title>outq</title><polygon fill="none" stroke="#000" points="474.572 -56.087 429.428 -56.087 429.428 -62.087 411.428 -44.087 429.428 -26.087 429.428 -32.087 474.572 -32.087 474.572 -56.087"/><text x="443" y="-47.388" fill="#000" font-family="arial" font-size="11" text-anchor="middle">send</text><text x="443" y="-34.188" fill="#000" font-family="arial" font-size="11" text-anchor="middle">TBQueue</text></g><g id="edge18" class="edge"><title>client-&gt;outq</title><path fill="none" stroke="#00f" d="M569.0363,-262.148C560.7382,-221.1225 540.9769,-144.0325 502,-90.175 496.236,-82.2103 488.7272,-74.9287 481.0081,-68.6219"/><polygon fill="#00f" stroke="#00f" points="472.622 -62.175 483.293 -64.702 476.586 -65.222 480.55 -68.27 480.55 -68.27 480.55 -68.27 476.586 -65.222 477.807 -71.837 472.622 -62.175 472.622 -62.175"/></g><g id="edge20" class="edge"><title>send-&gt;cs</title><path fill="none" stroke="#00f" d="M478.3046,-318.7693C477.35,-357.7707 475.6436,-427.4808 474.6911,-466.3911"/><polygon fill="#00f" stroke="#00f" points="474.444 -476.498 470.19 -466.391 474.566 -471.5 474.688 -466.501 474.688 -466.501 474.688 -466.501 474.566 -471.5 479.187 -466.611 474.444 -476.498 474.444 -476.498"/></g><g id="edge12" class="edge"><title>inq-&gt;client</title><path fill="none" stroke="#00f" d="M377.6198,-62.2326C413.1933,-103.5575 500.6514,-205.1552 545.8859,-257.703"/><polygon fill="#00f" stroke="#00f" points="552.506 -265.393 542.571 -260.75 549.244 -261.604 545.982 -257.814 545.982 -257.814 545.982 -257.814 549.244 -261.604 549.392 -254.878 552.506 -265.393 552.506 -265.393"/></g><g id="edge14" class="edge"><title>subscriber-&gt;outq</title><path fill="none" stroke="#00f" d="M546.4214,-44.0875C526.1863,-44.0875 503.5804,-44.0875 484.6766,-44.0875"/><polygon fill="#00f" stroke="#00f" points="474.594 -44.087 484.594 -39.588 479.594 -44.087 484.594 -44.088 484.594 -44.088 484.594 -44.088 479.594 -44.087 484.594 -48.588 474.594 -44.087 474.594 -44.087"/><text x="510.528" y="-50.087" fill="#00f" font-family="arial" font-size="10" text-anchor="middle">MSG</text></g><g id="edge19" class="edge"><title>outq-&gt;send</title><path fill="none" stroke="#00f" d="M445.66,-62.2842C451.4907,-102.1724 465.5041,-198.0375 473.381,-251.9232"/><polygon fill="#00f" stroke="#00f" points="474.87 -262.112 468.971 -252.868 474.147 -257.164 473.424 -252.217 473.424 -252.217 473.424 -252.217 474.147 -257.164 477.877 -251.566 474.87 -262.112 474.87 -262.112"/></g></g></svg>